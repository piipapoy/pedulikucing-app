generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// --- USER & ROLES ---
model User {
  id              Int      @id @default(autoincrement())
  name            String
  email           String   @unique
  password        String
  role            Role     @default(USER)

  nickname        String?
  phoneNumber     String?
  
  // --- DATA SHELTER & KLINIK ---
  shelterAddress  String?  @db.Text
  isClinic        Boolean  @default(false) 
  clinicOpenHours String?  
  documentKtp     String?  // Field baru untuk path KTP
  shelterPhotos   String?  @db.Text // Field baru untuk path banyak foto (comma separated)
  
  isShelterVerified Boolean @default(false) 

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relasi tetap sama seperti sebelumnya
  adoptions       Adoption[]      
  reports         Report[]        
  cats            Cat[]           
  campaigns       Campaign[]      
  donations       Donation[]
  sentMessages     Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
}

// --- KUCING (PRODUK) ---
model Cat {
  id          Int      @id @default(autoincrement())
  name        String
  age         Int
  gender      String
  breed       String
  description String   @db.Text
  imageUrl    String   
  
  isAdopted   Boolean  @default(false) 
  isApproved  Boolean  @default(false) 
  
  shelterId   Int
  shelter     User     @relation(fields: [shelterId], references: [id])
  adoptions   Adoption[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// --- ADOPSI ---
model Adoption {
  id          Int            @id @default(autoincrement())
  userId      Int
  user        User           @relation(fields: [userId], references: [id])
  catId       Int
  cat         Cat            @relation(fields: [catId], references: [id])
  
  address     String         @db.Text 
  phone       String
  reason      String         @db.Text
  idCardImage String?        
  houseImage  String?        

  status      AdoptionStatus @default(PENDING) 
  
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
}

// --- DONASI & CAMPAIGN ---
model Campaign {
  id            Int      @id @default(autoincrement())
  title         String
  description   String   @db.Text
  targetAmount  Decimal  
  currentAmount Decimal  @default(0) 
  imageUrl      String?

  isApproved    Boolean  @default(false) 
  isClosed      Boolean  @default(false) 

  shelterId     Int
  shelter       User     @relation(fields: [shelterId], references: [id])
  donations     Donation[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Donation {
  id          Int      @id @default(autoincrement())
  amount      Decimal
  message     String?  
  
  userId      Int?     
  user        User?    @relation(fields: [userId], references: [id])
  campaignId  Int
  campaign    Campaign @relation(fields: [campaignId], references: [id])

  status      String   @default("SUCCESS") 
  createdAt   DateTime @default(now())
}

// --- LAPORAN DARURAT ---
model Report {
  id              Int      @id @default(autoincrement())
  
  // Identitas Pelapor
  userId          Int?     // Nullable jika Guest
  user            User?    @relation(fields: [userId], references: [id])
  reporterName    String?  // Wajib jika userId null
  reporterPhone   String?  // Wajib jika userId null

  // Detail Kondisi (Sesuai Desain Figma kamu)
  conditionTags   String   // Disimpan sebagai string "Tag1, Tag2, Tag3"
  description     String?  @db.Text
  
  // Media
  imageUrl        String
  videoUrl        String?

  // Lokasi
  address         String   @db.Text
  latitude        Float
  longitude       Float

  // Status Laporan
  status          ReportStatus @default(PENDING)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// --- CHAT (REAL TIME) ---
model Message {
  id        Int      @id @default(autoincrement())
  content   String   @db.Text
  
  senderId  Int
  sender    User     @relation("SentMessages", fields: [senderId], references: [id])
  
  receiverId Int
  receiver   User    @relation("ReceivedMessages", fields: [receiverId], references: [id])
  
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}

// --- ENUMS ---
enum Role {
  USER
  ADMIN
  SHELTER
}

enum AdoptionStatus {
  PENDING       
  INTERVIEW     
  APPROVED      
  COMPLETED     
  REJECTED      
  CANCELLED     
}

enum ReportStatus {
  PENDING
  VERIFIED
  ON_PROCESS
  RESCUED
  REJECTED
}